/**
 * WhereNow plugin.
 *
 * Used to determine if the user is within a specific time and place (if possible).
 *
 * @author Kalley Powell (kalley.powell AT gmail.com)
 *
 */
(function(c,z){var r=z.navigator;c.support.geolocation=r.geolocation;c.whereNow=function(d,a,f,i){return n.instance(d,a,f,i)};var m=null,o,n=function(d,a,f){function i(e,j){var p=new Date,k,s=function(g){if(c.isPlainObject(g)){g=g[e?"here":"there"];if(!g)g=g.here}return g};if(t<p&&p<u){l=0;for(v=a.length;l<v;l++)if(a[l].start<p)k=s(a[l].panel);else break}else{k=b[t>p?"before":"after"];k=s(k?k:b._default)}return j.panel=k}var l=0,h=[],v;this.panel="";if(!d||!d.lat||!d.lng)c.error("You must pass latitude and longitude coordinates");
if(a){if(!c.isArray(a)){for(var q in a)h[l++]=a[q];a=h}a.sort(function(e,j){return e.start-j.start});var b=c.extend({},this.defaults,f);f=new Date;h=a[a.length-1];q=function(e){return e.charAt(0).toUpperCase()+e.substring(1)}(b.duration.type.toLowerCase());var t=a[0].start,u=h.end?h.end:new Date((new Date(h.start.valueOf()))["set"+q](h.start["get"+q]()+b.duration.howMany).valueOf()),w=this.panel;if(f>u&&(b.after&&!c.isPlainObject(b.after)||!c.isPlainObject(b._default)))b.onUpdate(i(false),w);else if(c.support.geolocation&&
m===null){var x=99,y=99,A=this;(function e(){b.onUpdate(i(x+y<=b.coordBuffer,A),w);r.geolocation.getCurrentPosition(function(j){x=Math.abs(d.lat-j.coords.latitude);y=Math.abs(d.lng-j.coords.longitude);o=setTimeout(e,b.delay)},function(){o=setTimeout(e,b.delay)})})()}}};c.whereNow.defaults=n.prototype.defaults={_default:"#home",after:null,before:null,coordBuffer:0.0020,delay:3E3,duration:{type:"Minutes",howMany:30},onUpdate:function(){}};n.instance=function(d,a,f,i){if(m===null||i){clearTimeout(o);
m=o=null;m=new n(d,a,f)}return m}})(jQuery,window);