/**
 * WhereNow plugin.
 *
 * Used to determine if the user is within a specific time and place (if possible).
 *
 * @author Kalley Powell (kalley.powell AT gmail.com)
 *
 */
(function(c,C){var t=C.navigator;c.support.geolocation=t.geolocation;c.whereNow=function(e,a,f,l){return o.instance(e,a,f,l)};var n=null,p,o=function(e,a,f){function l(d,g){var h=new Date,m,u,v=function(i){if(c.isPlainObject(i)){i=i[d?"here":"there"];if(!i)i=i.here}return i};if(w<h&&h<x){j=0;for(y=a.length;j<y;j++)if(a[j].start<h){m=v(a[j].panel);u=a[j]}else break}else{m=b[w>h?"before":"after"];m=v(m?m:b._default)}q=g.currentItem=u;return g.panel=m}var j=0,k=[],y;this.panel="";this.currentItem=null;
if(!e||!e.lat||!e.lng)c.error("You must pass latitude and longitude coordinates");if(a){if(!c.isArray(a)){for(var r in a)k[j++]=a[r];a=k}a.sort(function(d,g){return d.start-g.start});var b=c.extend({},this.defaults,f);f=new Date;k=a[a.length-1];r=function(d){return d.charAt(0).toUpperCase()+d.substring(1)}(b.duration.type.toLowerCase());var w=a[0].start,x=k.end?k.end:new Date((new Date(k.start.valueOf()))["set"+r](k.start["get"+r]()+b.duration.howMany).valueOf()),s=this.panel,q=this.currentItem;if(f>
x&&(b.after&&!c.isPlainObject(b.after)||!c.isPlainObject(b._default)))b.onUpdate(l(false),s);else if(c.support.geolocation&&n===null){var z=99,A=99,B=this;(function d(){var g=q&&q.coords?q.coords:e;b.onUpdate(l(z+A<=b.coordBuffer,B),s);s=B.panel;t.geolocation.getCurrentPosition(function(h){z=Math.abs(g.lat-h.coords.latitude);A=Math.abs(g.lng-h.coords.longitude);p=setTimeout(d,b.delay)},function(){p=setTimeout(d,b.delay)})})()}}};c.whereNow.defaults=o.prototype.defaults={_default:"#home",after:null,
before:null,coordBuffer:0.0020,delay:3E3,duration:{type:"Minutes",howMany:30},onUpdate:function(){}};o.instance=function(e,a,f,l){if(n===null||l){clearTimeout(p);n=p=null;n=new o(e,a,f)}return n}})(jQuery,window);